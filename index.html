<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø²</title>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root { /* ... Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª ... */
            --black-bg: #1A1A2E; 
            --darker-bg: #0F0F1B;
            --yellow-card: #FFD700; 
            --yellow-shadow: rgba(255, 215, 0, 0.4); 
            --light-text: #FFFFFF;
            --gray-text: #A0A0B0;
            --green-active: #00F5C4;
            --red-error: #FF4F4F;
            --pending: #ffb347;
        }
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--darker-bg), var(--black-bg));
            color: var(--light-text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .glass-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 50px 40px;
            max-width: 450px;
            width: 100%;
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        h1 { color: var(--yellow-card); margin-bottom: 25px; font-weight: 700; }
        .action-card {
            background: var(--yellow-card);
            color: var(--black-bg);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px var(--yellow-shadow);
            border: none;
            width: 100%;
            text-align: center;
        }
        .action-card:hover { transform: translateY(-3px); box-shadow: 0 12px 35px var(--yellow-shadow); }
        .card-message { 
            background: var(--darker-bg); 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            font-size: 16px; 
            font-weight: 500; 
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #loginForm input {
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; background: rgba(0, 0, 0, 0.3); color: var(--light-text); font-family: 'Tajawal', sans-serif; font-size: 18px;
            text-align: center;
        }
        #loginForm button { 
            background: var(--green-active); 
            color: var(--black-bg); 
            margin-top: 15px; 
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(0, 245, 196, 0.4);
        }
        /* ** Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø®Ø§Ù†Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ ** */
.top-status-bar {
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 25px;
    text-align: right;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.05);
    display: flex;
    justify-content: space-between; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø²Ø±Ø§Ø± ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±Ù Ø§Ù„ØªØ§Ù†ÙŠ */
    align-items: center;
    flex-wrap: wrap; 
}

.status-text {
    font-size: 16px;
    font-weight: 500;
}

.code-display {
    color: var(--green-active); /* Ø¹Ø´Ø§Ù† ÙŠÙƒÙˆÙ† Ù„Ø§ÙØª Ù„Ù„Ù†Ø¸Ø± */
    font-weight: 700;
    font-family: monospace;
    font-size: 18px;
    margin-right: 10px;
}

.clear-btn {
    background: var(--red-error); /* Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ù„ÙˆÙ†Ù‡ Ø£Ø­Ù…Ø± */
    color: var(--light-text);
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: 0.3s;
    margin-top: 5px; /* Ø¹Ø´Ø§Ù† ÙŠØ¨Ù‚Ù‰ ÙÙŠ Ù…Ø³Ø§ÙØ© Ù„Ùˆ Ù†Ø²Ù„ Ø³Ø·Ø± */
}
.clear-btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}
    </style>
</head>
<body>
    <div class="glass-container">
        <div id="topCodeStatus" class="top-status-bar">
        
       
        <h1>Ù…Ù†ØµØ© 1383 Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
        </div>

        <div id="statusMessage" class="card-message" style="color:var(--yellow-card);">
            ğŸ”‘ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¯Ø®ÙˆÙ„
        </div>
        
        <form id="loginForm">
            <input type="text" id="activationCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ (6 Ø£Ø±Ù‚Ø§Ù…)" pattern="\d{6}" maxlength="6" required>
            <button type="submit" id="loginBtn" class="action-card">ğŸš€ ØªÙØ¹ÙŠÙ„ ÙˆØ¯Ø®ÙˆÙ„</button>
        </form>

         <button class="action-card" id="contactBtn" style="background:transparent; color:var(--yellow-card); border:1px solid var(--yellow-card); box-shadow:none; margin-top: 20px;" onclick="window.location.href='https://sara1383sara.github.io/c/'">ğŸ’¬ Ø±Ø§Ø³Ù„Ù†ÙŠ</button> 

        

        
    </div>

    <script>
        // ğŸš¨ Configuration - Ù„Ø§Ø²Ù… ØªØ­Ø· Ø§Ù„Ù€ Configuration Ø¨ØªØ§Ø¹Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù‡Ù†Ø§
        const firebaseConfig = {
          apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
          authDomain: "thanawy-1383.firebaseapp.com",
          databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
          projectId: "thanawy-1383",
          storageBucket: "thanawy-1383.firebasestorage.app",
          messagingSenderId: "1026664406457",
          appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68",
          measurementId: "G-J5R2EFM2D0"
        };
        
        if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        const STATUS_MESSAGE = document.getElementById('statusMessage');
        const LOGIN_FORM = document.getElementById('loginForm');
        const LOGIN_BTN = document.getElementById('loginBtn');
        const ACTIVATION_CODE_INPUT = document.getElementById('activationCode');

        // **********************************************
        // ğŸš¨ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ØªÙˆÙ„ÙŠØ¯ Device ID ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
        // **********************************************

        // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Device ID ÙØ±ÙŠØ¯ Ù„Ù„Ø¬Ù‡Ø§Ø² (Ù‡ÙŠÙƒÙˆÙ† ÙƒÙˆØ¯ Ø·ÙˆÙŠÙ„ Ø¹Ø´Ø§Ù† ÙØ±ØµØ© Ø§Ù„ØªÙƒØ±Ø§Ø± ØªÙƒÙˆÙ† ØµÙØ±)
        function generateDeviceID() {
             return 'DID-' + Math.random().toString(36).substring(2, 10).toUpperCase() + Date.now().toString(36);
        }

        // 1. Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø£Ùˆ ØªÙˆÙ„ÙŠØ¯ Device ID Ù„Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ
        let localDeviceId = localStorage.getItem('localDeviceId');
        if (!localDeviceId) {
            localDeviceId = generateDeviceID();
            localStorage.setItem('localDeviceId', localDeviceId);
        }
        // ... (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€ JavaScript Ø¨ØªØ§Ø¹Ùƒ) ...

// ğŸ’¡ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø¹Ø±Ø¶ ÙˆØ­Ø°Ù ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„
// 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ù…ØªØ®Ø²Ù† Ù…Ø­Ù„ÙŠØ§Ù‹
const activeCode = localStorage.getItem('activeCode');
const codeStatusDiv = document.getElementById('topCodeStatus');

// 2. Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
function clearLocalCode() {
    localStorage.removeItem('activeCode');
    localStorage.removeItem('localDeviceId');
    localStorage.removeItem('approved'); // Ù„Ùˆ Ø¨ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ù€ Flag Ø¯Ù‡
    
    STATUS_MESSAGE.textContent = 'âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­. Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...';
    STATUS_MESSAGE.style.color = 'var(--green-active)';
    LOGIN_BTN.disabled = true;

    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

// 3. Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
if (activeCode) {
    codeStatusDiv.innerHTML = `
        <span class="status-text">ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="code-display">${activeCode}</span></span>
        <button class="clear-btn" onclick="clearLocalCode()">Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</button>
    `;
    
    // ğŸ’¡ Ù†Ù‚Ø·Ø© Ù…Ù‡Ù…Ø©: Ù…Ù…ÙƒÙ† ØªØ¹Ù…Ù„ Ù‡Ù†Ø§ ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙŠØ³Ø¬Ù„Ø´ Ø¯Ø®ÙˆÙ„Ù‡ ØªØ§Ù†ÙŠ
    // Ø¨Ø³ Ø¹Ø´Ø§Ù† Ø·Ù„Ø¨ØªÙ‡ØŒ Ø®Ù„ÙŠØªÙ‡ ÙŠØ¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø³ØŒ Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø´ÙŠÙ„ Ø§Ù„Ù€ Comment Ù…Ù† ØªØ­Øª:
    /*
    STATUS_MESSAGE.textContent = 'âœ… ÙƒÙˆØ¯Ùƒ Ù…ÙØ³Ø¬Ù„. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
    STATUS_MESSAGE.style.color = 'var(--green-active)';
    setTimeout(() => {
        window.location.href = 'subjects.html'; 
    }, 500);
    */

} else {
    codeStatusDiv.innerHTML = `<span class="status-text" style="color:var(--gray-text);">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ù…ÙØ­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</span>`;
}


// ... (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€ JavaScript Ø¨ØªØ§Ø¹ÙƒØŒ Ø²ÙŠ Ø§Ù„Ù€ checkAndLogin function) ...

        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
        LOGIN_FORM.addEventListener('submit', (e) => {
            e.preventDefault();
            checkAndLogin();
        });

        async function checkAndLogin() {
            const activationCode = ACTIVATION_CODE_INPUT.value.trim();
            
            if (activationCode.length !== 6 || isNaN(activationCode)) {
                STATUS_MESSAGE.textContent = 'âŒ Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù….';
                STATUS_MESSAGE.style.color = 'var(--red-error)';
                return;
            }

            LOGIN_BTN.disabled = true;
            STATUS_MESSAGE.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„...';
            STATUS_MESSAGE.style.color = 'var(--yellow-card)';

            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯ Ù†ÙØ³Ù‡ ÙƒÙ€ Key
                const snapshot = await db.ref('approvedStudents/' + activationCode).once('value');
                const data = snapshot.val();
                const now = Date.now();

                if (!data) {
                    STATUS_MESSAGE.textContent = 'âŒ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.';
                    STATUS_MESSAGE.style.color = 'var(--red-error)';
                    return;
                }

                if (data.expiry <= now) {
                    STATUS_MESSAGE.textContent = 'âŒ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.';
                    STATUS_MESSAGE.style.color = 'var(--red-error)';
                    // Ù…Ù…ÙƒÙ† ØªØ­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ Ù…Ù† Firebase Ù‡Ù†Ø§
                    // db.ref('approvedStudents/' + activationCode).remove();
                    return;
                }
                
                if (data.isBlocked === true) {
                    STATUS_MESSAGE.textContent = 'âŒ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…ÙØ¹Ø·Ù‘Ù„ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.';
                    STATUS_MESSAGE.style.color = 'var(--red-error)';
                    return;
                }


                // ğŸš¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø´Ø±Ø· Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ÙˆØ§Ø­Ø¯ 
                const storedDeviceId = data.deviceId;

                if (!storedDeviceId) {
                    // Ø§Ù„ÙƒÙˆØ¯ Ø³Ù„ÙŠÙ… ÙˆØ¬Ù‡Ø§Ø² Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‡Ùˆ Ø£ÙˆÙ„ Ø¬Ù‡Ø§Ø² ÙŠØ³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    
                    // 1. ØªØ­Ø¯ÙŠØ« Firebase Ø¨ÙƒÙˆØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ
                    await db.ref('approvedStudents/' + activationCode + '/deviceId').set(localDeviceId);
                    
                    // 2. ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ localStorage Ø¹Ø´Ø§Ù† ØµÙØ­Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ø±ÙÙ‡
                    localStorage.setItem('activeCode', activationCode);
                    localStorage.setItem('approved', 'true');
                    
                    STATUS_MESSAGE.textContent = 'âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
                    STATUS_MESSAGE.style.color = 'var(--green-active)';
                    
                    setTimeout(() => {
                        window.location.href = 'subjects.html'; // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    }, 1000);
                    
                } else if (storedDeviceId === localDeviceId) {
                    // Ø§Ù„ÙƒÙˆØ¯ Ø³Ù„ÙŠÙ… ÙˆÙ…ÙØ¹Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²
                    
                    localStorage.setItem('activeCode', activationCode);
                    localStorage.setItem('approved', 'true');
                    
                    STATUS_MESSAGE.textContent = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
                    STATUS_MESSAGE.style.color = 'var(--green-active)';

                    setTimeout(() => {
                        window.location.href = 'subjects.html'; // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    }, 1000);

                } else {
                    // âŒ Ø§Ù„ÙƒÙˆØ¯ Ø³Ù„ÙŠÙ… Ù„ÙƒÙ† Ù…ÙØ¹Ù„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±
                    STATUS_MESSAGE.textContent = 'âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙÙØ¹Ù„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø± Ø¨Ø§Ù„ÙØ¹Ù„.';
                    STATUS_MESSAGE.style.color = 'var(--red-error)';
                }

            } catch (error) {
                STATUS_MESSAGE.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                STATUS_MESSAGE.style.color = 'var(--red-error)';
                console.error("Firebase error:", error);
            } finally {
                LOGIN_BTN.disabled = false;
            }
        }
        
    </script>
</body>
</html>
